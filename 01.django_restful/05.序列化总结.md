# 序列化器总结

## 一.反序列化整体流程

### 1. 基本流程

```python
1. # 接受前端传来的数据
data = {
    "btitle":"三国",
    "bpub_date":"2021-03-02"
}
2. # 创建一个序列化对象
serializer = BookInfoSerializer(data=data)
# 校验,先去校验类型，再进行校验其他的，比如是否是在长度内
3. serializer.is_valid() # 校验成功返回True 否则反False
# 加入异常处理,这个时候就不用调用errors方法了,直接抛出异常，这个时候可以去直接捕获异常即可
# serialiser.is_valid(raise_execption=True)
# 获取校验的错误信息
4. serializer.errors
# 获取反序列化校验后的数据还是字典
5. serializer.validated_data
```

### 2. 添加字段校验

- 添加校验字段，方法命名为：validate_字段名，传入的Value值是对应的字段的值，最后需要返回一个值

  ```python
  class BookInfoTestSerializer(serializers.Serializer):
      """
      获取书籍测试序列化数据
      """
      id = serializers.IntegerField(label="ID", read_only=True)
      btitle = serializers.CharField(max_length=20, required=True)
      bpub_date = serializers.DateField(label="发布时间", required=True)
      heroinfo_set = HeroInfoSerializer(many=True, required=False)
  
      def validate_btitle(self,value):
          # 对一个个字段进行校验
          if 'd' not in value:
              # 抛出的异常必须是ValidationError('')
              raise serializers.ValidationError("错误的校验") 
          return value
  ```

  

- 如果需要对所有的字段验证，比如要对密码与确认密码两个字段进行校验

  可以使用如下

  ```python
  class BookInfoTestSerializer(serializers.Serializer):
      """
      获取书籍测试序列化数据
      """
      id = serializers.IntegerField(label="ID", read_only=True)
      btitle = serializers.CharField(max_length=20, required=True)
      bpub_date = serializers.DateField(label="发布时间", required=True)
      heroinfo_set =  (many=True, required=False)
  
      def validate(self,attrs):
          # 对多个字段进行校验
          bread = attrs['bread']
          bcomment = attrs['bcomment']
          if bread < bcomment:
              raise serializers.ValidationError("错误的校验") 
          return attrs
  ```

  - validators
  
    在字段中添加validators选项参数也可以补充验证行为，如
  
    ```python
     class BookInfoTestSerializer(serializers.Serializer):
        """
        获取书籍测试序列化数据
        """
        # 单独定义一个函数
        def valid_test(value):
    
            if '2021' not in str(value):
                raise serializers.ValidationError('年份错误')
            return value
        
        def validate_btitle(self,value):
            if 'd' not in value:
                raise serializers.ValidationError("错误的校验") 
            return value
    
        def validate(self,attrs):
            attrs['hello'] = 'zgx'
            return attrs
    
    
        id = serializers.IntegerField(label="ID", read_only=True)
        btitle = serializers.CharField(max_length=20, required=True)
        # 在这里使用
        bpub_date = serializers.DateField(label="发布时间", required=True, validators=[valid_test])
        heroinfo_set = HeroInfoSerializer(many=True, required=False)
    
     
    
        def create(self, validated_data):
            return BookInfo.objects.create(**validated_data)
    
    ```
  
    

## 二 函数介绍

1. is_valid()方法

   在获取反序列化的数据前，必须调用is_vaild()方法进行颜值验证，验证成功返回True,否则为False

2. error属性

   验证失败，可以通过

   